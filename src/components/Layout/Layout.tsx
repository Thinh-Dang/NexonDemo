import { FC, useEffect, useState } from 'react';
import style from './Layout.module.scss';

import Head from 'next/head';
import { useRouter } from 'next/router';
import { useAppSelector, RootState, useAppDispatch } from '@/redux';
import { Footer, Header } from '../common';
import Loading from '../Loading/Loading';
import { getProfile } from '@/redux/slice/userSlice';
import { ILayout } from '@/@type/components';

export const Layout: FC<ILayout> = ({
  children,
  isHeader = true,
  isFooter = true,
  isLogo = false,
  title,
}) => {
  const router = useRouter();
  const location = router.pathname;
  const dispatch = useAppDispatch();
  const [isFetch, setIsFectch] = useState(false);
  const isLogin = useAppSelector((state: RootState) => state.userSlice.isLogin);

  const fecthInfo = async () => {
    const check = (await dispatch(getProfile())).payload;

    if (check) {
      setIsFectch(true);
    }
  };

  useEffect(() => {
    fecthInfo();
  }, []);

  if (!isFetch) {
    return <Loading />;
  }

  if (!isLogin && location !== '/auth/login' && location !== '/') {
    router.push('/');
  }

  if (isLogin && location === '/auth/login') {
    router.push('/finding');
    return <Loading />;
  }

  return (
    <div className={style.layout}>
      <Head>
        <title>{title}</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {isHeader && <Header isLogo={isLogo} />}
      <div className={style.children}>{children}</div>
      {isFooter && <Footer />}
    </div>
  );
};
